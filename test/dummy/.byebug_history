continue
Account::User
c
main_app.manager_root_path
main_app.admin_root_path
main_app.user_root_path
main_app.root_path
main_app.routes.as_json
main_app.routes.methods
main_app.routes.methos
main_app.routes.all
main_app.routes
main_app
@_routes
_routes.all
_routes
routes
app.user_root_path
app.root_path
phone_verification_new_path
user_session_path
manager_root_path
manager_root
account.user_root_path
account.user_root_paht
root_path
users_root_path
user_root_path
 after_sign_in_path_for(Account::Admin)
 after_sign_in_path_for(current_user)
 after_sign_in_path_for(Account::User)
current_user
c
Account::Identify.count
Account::Identify.all
Account::User.last.identifies
Account::User.last.identifys
Account::User.last.identify
Account::User.last.unionid
Account::User.last
Account::User.count
Account::User.length
Account::User.all
Account::Users.all
 auth_info
n
c
uri.to_s
uri
n
request.original_url
c
request.params["state"] == session["omniauth.state"]
session["omniauth.state"]
c
session["omniauth.state"]
c
session["omniauth.state"]
c
session["omniauth.state"]
c
session["omniauth.state"]
session
c
n
options.provider_ignores_state =true
options.provider_ignores_state
request.params["state"]
params["state"]
c
session["omniauth.state"]
c
session
session["omniauth.state"]
c
session["omniauth.state"]
request.env["omniauth.auth"]
00
D, [2022-05-07T12:22:36.504490 #33147] DEBUG -- omniauth: (open_wechat) Callback phase initiated.
c
request.env['omniauth.auth'] 
get_info
c
params
request.env['omniauth.auth'] 
c
access_token["scope"]&.include?("snsapi_login")
access_token["scope"]&
access_token["scope"]
c
JSON.parse res
res = Net::HTTP.get(uri)
Net::HTTP.get(uri).to_hash
Net::HTTP.get(uri)
uri = URI('https://api.weixin.qq.com/sns/userinfo?access_token=56_H6Fz3INd5nH_GYPZYjOXCb3o1HO5GJEnFvn9Wn6we-viD6Qa84RfOB5Lzucu3yYsh8qbK_Iw9c3RakyMWoYvSQ&openid=o3jBmt91YRMtZDvZZk-96C20jhSg&lang=zh_CN')
Net::HTTP.get(uri)
uri = URI('https://api.weixin.qq.com/sns/userinfo?access_token=56_H6Fz3INd5nH_GYPZYjOXCb3o1HO5GJEnFvn9Wn6we-viD6Qa84RfOB5Lzucu3yYsh8qbK_Iw9c3RakyMWoYvSQ&openid=o3jBmt91YRMtZDvZZk-96C20jhSg')
res.body
res
res = Net::HTTP.get(uri)
Net::HTTP.get(uri)
uri
uri = URI('https://api.weixin.qq.com/sns/auth?access_token=56_H6Fz3INd5nH_GYPZYjOXCb3o1HO5GJEnFvn9Wn6we-viD6Qa84RfOB5Lzucu3yYsh8qbK_Iw9c3RakyMWoYvSQ&openid=o3jBmt91YRMtZDvZZk-96C20jhSg')
Net::HTTP.get 'https://api.weixin.qq.com/sns/auth?access_token=56_H6Fz3INd5nH_GYPZYjOXCb3o1HO5GJEnFvn9Wn6we-viD6Qa84RfOB5Lzucu3yYsh8qbK_Iw9c3RakyMWoYvSQ&openid=o3jBmt91YRMtZDvZZk-96C20jhSg'
Net::HTTP.get
raw_info["openid"]
raw_info
info
openid
access_token.token
access_token
client.access_token
access_token
token
client.access_token
client.token_url
client.token
require 'rest-client'
client
self
env['omniauth.auth']
n
s
auth_hash
self.access_token
c
request.env["omniauth.auth"]
c
request.env["omniauth.auth"]
c
wechat_user_info
raw_info
c
n
